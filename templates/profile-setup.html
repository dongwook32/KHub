<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KBU hub | ìµëª… í”„ë¡œí•„ ì„¤ì •</title>
  <link rel="icon" href="{{ url_for("static", filename="images/logo.png") }}">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for("static", filename="css/nav.css") }}">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { peach: '#FFC8B2', peachDeep: '#FF9F80', cream: '#FFF7F2', cocoa:'#6B7280', ink:'#1F2937', mint:'#B7F4E6', lemon:'#FFF3A3' },
          boxShadow: { soft:'0 10px 30px rgba(255,159,128,.18)', glow:'0 0 0 0 rgba(255,159,128,.0)', card:'0 10px 24px rgba(17,24,39,.08)' },
          borderRadius: { bubble:'999px', xl2:'1.25rem' }
        }
      }
    }
  </script>
  <style>
    html, body { font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; }
    .top-grad{ background: radial-gradient(60% 60% at 0% 0%, #FFF0E7 0%, rgba(255,240,231,0) 60%), radial-gradient(60% 60% at 100% 0%, #FFE7DB 0%, rgba(255,231,219,0) 60%); }
    .glass{ background: rgba(255,255,255,.7); backdrop-filter: blur(10px); }
    /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ì€ nav.css (CSS Cascade Layers)ì—ì„œ ê´€ë¦¬ */
    
    /* í—¤ë” ìŠ¤íƒ€ì¼ì€ navigation.cssì—ì„œ ê´€ë¦¬ */
    
    /* í”„ë¡œí•„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .profile-card {
        background: linear-gradient(135deg, #ffffff 0%, #fefefe 100%);
        box-shadow: 0 20px 60px rgba(255, 159, 128, 0.15), 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 200, 178, 0.3);
        position: relative;
    }
    
    .profile-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 200, 178, 0.05) 0%, rgba(183, 244, 230, 0.05) 100%);
        border-radius: inherit;
        pointer-events: none;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 159, 128, 0.15);
    }
    
    .gender-btn {
        background: #f8f9fa;
        border-color: #dee2e6;
        color: #6c757d;
        transition: all 0.3s ease;
    }
    
    .gender-btn:hover {
        background: #e9ecef;
        border-color: #FF9F80;
        color: #495057;
    }
    
    .gender-btn.active {
        background: #f8f9fa;
        border-color: #FF7B54;
        border-width: 2px;
        color: #495057;
        font-weight: 600;
    }
    
    .interest-chip.selected {
        background: linear-gradient(135deg, #FF9F80, #FFC8B2);
        border-color: #FF9F80;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 159, 128, 0.3);
    }
    
    .save-btn:hover {
        box-shadow: 0 12px 40px rgba(255, 159, 128, 0.4);
        transform: translateY(-2px);
    }
    
    .profile-card:hover {
        transform: translateY(-5px);
        transition: transform 0.3s ease;
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
        .profile-card {
            margin: 16px;
            padding: 24px;
        }
        
        .grid.md\\:grid-cols-2 {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .flex.gap-4 {
            flex-direction: column;
            gap: 12px;
        }
        
        .save-btn, .delete-btn {
            width: 100%;
        }
    }
    
    /* í†µì¼ëœ Footer ìŠ¤íƒ€ì¼ */
    footer {
        border-top: 1px solid rgba(255, 200, 178, 0.5);
        margin-top: 0;
        padding: 0;
    }
    
    footer > div {
        max-width: 72rem;
        margin: 0 auto;
        padding: 1.5rem 1rem;
        font-size: 0.875rem;
        line-height: 1.25rem;
        color: #6B7280;
        text-align: center;
    }
  </style>
</head>
<body class="bg-cream">
  <div class="top-grad h-[160px] w-full absolute inset-0 -z-10 pointer-events-none"></div>

  <header class="fixed top-0 left-0 right-0 z-50 border-b border-peach/40 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="{{ url_for('index') }}" class="flex items-center gap-2 font-extrabold text-lg">
        <img src="{{ url_for("static", filename="images/logo.png") }}" alt="KBU hub" class="w-9 h-9 rounded-full shadow-[0_8px_18px_rgba(255,159,128,.25)]">
        <span>hub</span>
      </a>
      <nav class="ml-auto hidden md:flex">
        <div id="navPill" class="nav-pill">
          <!-- ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì€ navigation.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
      </nav>
      <button id="menuBtn" class="md:hidden ml-auto p-2 rounded-full border border-peach/60">â˜°</button>
    </div>
    <div id="mobileNav" class="hidden md:hidden px-4 pb-3 border-t border-peach/40 bg-white/70">
      <div class="flex flex-col gap-1 py-2 text-sm">
        <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´í…œì€ navigation.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </header>

  <main class="anonymous-card-container" style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: calc(100vh - 120px); padding: 40px 25px; box-sizing: border-box; max-width: 1200px; margin: 0 auto; background: transparent; margin-top: 80px;">
    <!-- ìµëª… í”„ë¡œí•„ ì¹´ë“œ -->
    <div class="text-center mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-2" id="pageTitle">ìµëª… í”„ë¡œí•„ ë§Œë“¤ê¸°</h2>
        <p class="text-gray-600" id="pageDesc">ë‚˜ë§Œì˜ íŠ¹ë³„í•œ ìµëª… í”„ë¡œí•„ì„ ì˜ˆì˜ê²Œ ê¾¸ë©°ë³´ì„¸ìš”!</p>
    </div>
    
    <div class="profile-card bg-white rounded-3xl shadow-2xl p-8 border border-peach/20 relative overflow-hidden" style="max-width: 700px; width: 100%; margin: 0 auto;">
        <!-- ì¹´ë“œ ì¥ì‹ ìš”ì†Œ -->
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-peach/20 to-lemon/20 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-mint/20 to-peach/20 rounded-full translate-y-12 -translate-x-12"></div>
        
        <form id="anon-form" class="relative z-10" method="POST" action="{{ url_for('profile_setup') }}">
            <!-- í•™ë²ˆ & ì„±ë³„ ì„ íƒ -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <span class="inline-block mr-2">ğŸ“</span>ëª‡ í•™ë²ˆì¸ê°€ìš”?
                    </label>
                    <select name="year" id="ap_year" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-2xl bg-white text-gray-700 focus:border-peachDeep focus:ring-4 focus:ring-peach/20 transition-all duration-300 hover:border-peach/50">
                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="25í•™ë²ˆ">25í•™ë²ˆ</option>
                        <option value="24í•™ë²ˆ">24í•™ë²ˆ</option>
                        <option value="23í•™ë²ˆ">23í•™ë²ˆ</option>
                        <option value="22í•™ë²ˆ">22í•™ë²ˆ</option>
                        <option value="21í•™ë²ˆ">21í•™ë²ˆ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <span class="inline-block mr-2">ğŸ‘¤</span>ì„±ë³„ ì„ íƒ
                    </label>
                    <input type="hidden" name="gender" id="gender_input" value="ë‚¨ì" required>
                    <div class="flex gap-2">
                        <button type="button" class="gender-btn flex-1 py-3 px-4 border-2 border-gray-200 rounded-2xl text-gray-600 font-medium transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 active" data-gender="ë‚¨ì" onclick="selectGender(this)">
                            <span class="mr-2">ğŸ™‹â€â™‚ï¸</span>ë‚¨ì
                        </button>
                        <button type="button" class="gender-btn flex-1 py-3 px-4 border-2 border-gray-200 rounded-2xl text-gray-600 font-medium transition-all duration-300 hover:border-peach/50 hover:bg-peach/10" data-gender="ì—¬ì" onclick="selectGender(this)">
                            <span class="mr-2">ğŸ™‹â€â™€ï¸</span>ì—¬ì
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
            <div class="form-group mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    <span class="inline-block mr-2">ğŸ·ï¸</span>ë‹‰ë„¤ì„ (ìµœëŒ€ 10ì)
                </label>
                <div class="relative">
                    <input type="text" name="nickname" id="ap_nickname" maxlength="10" placeholder="ì˜ˆ) ìµëª…ì˜ì¹œêµ¬" 
                           class="w-full px-4 py-3 pr-16 border-2 border-gray-200 rounded-2xl bg-white text-gray-700 focus:border-peachDeep focus:ring-4 focus:ring-peach/20 transition-all duration-300 hover:border-peach/50">
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 text-xs text-gray-400">
                        <span id="ap_nickname_count">0</span>/10
                    </div>
                </div>
            </div>

            <!-- ìê¸°ì†Œê°œ -->
            <div class="form-group mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    <span class="inline-block mr-2">ğŸ’¬</span>ìê¸°ì†Œê°œ (ìµœëŒ€ 100ì)
                </label>
                <div class="relative">
                    <textarea name="bio" id="ap_bio" rows="4" maxlength="100" 
                              placeholder="ì˜ˆ) ì‚¬ëŒ ë§Œë‚˜ ì–˜ê¸°í•˜ëŠ” ê±° ì¢‹ì•„í•´ìš”. ì˜í™”/ì¹´í˜/ì‚°ì±… ì¢‹ì•„í•©ë‹ˆë‹¤." 
                              class="w-full px-4 py-3 pr-16 border-2 border-gray-200 rounded-2xl bg-white text-gray-700 focus:border-peachDeep focus:ring-4 focus:ring-peach/20 transition-all duration-300 hover:border-peach/50 resize-none"></textarea>
                    <div class="absolute bottom-3 right-4 text-xs text-gray-400">
                        <span id="ap_count">0</span>/100
                    </div>
                </div>
            </div>

            <!-- ê´€ì‹¬ì‚¬ ì„ íƒ -->
            <div class="form-group mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-3">
                    <span class="inline-block mr-2">ğŸ¯</span>ê´€ì‹¬ì‚¬ ì„ íƒ (ìµœì†Œ 1ê°œ ì´ìƒ í•„ìˆ˜)
                    <span class="text-xs text-gray-500 ml-2">
                        <span id="selected-count">0</span>ê°œ ì„ íƒë¨
                    </span>
                </label>
                <div id="ap_interests" class="flex flex-wrap gap-2">
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ì˜í™”" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ¬</span>ì˜í™”
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ìš´ë™" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ’ª</span>ìš´ë™
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ê²Œì„" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ®</span>ê²Œì„
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ìŒì•…" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸµ</span>ìŒì•…
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ì¹´í˜" class="hidden interest-checkbox">
                        <span class="mr-1">â˜•</span>ì¹´í˜
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ì—¬í–‰" class="hidden interest-checkbox">
                        <span class="mr-1">âœˆï¸</span>ì—¬í–‰
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ìŠ¤í„°ë””" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ“š</span>ìŠ¤í„°ë””
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ë…ì„œ" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ“–</span>ë…ì„œ
                    </label>
                    <label class="interest-chip px-4 py-2 border-2 border-gray-200 rounded-full text-sm font-medium text-gray-600 transition-all duration-300 hover:border-peach/50 hover:bg-peach/10 hover:scale-105 cursor-pointer">
                        <input type="checkbox" name="interests" value="ë§›ì§‘" class="hidden interest-checkbox">
                        <span class="mr-1">ğŸ½ï¸</span>ë§›ì§‘
                    </label>
                </div>
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div class="flex gap-4">
                <button type="submit" class="save-btn flex-1 py-4 px-6 bg-gradient-to-r from-peachDeep to-peach text-white font-bold rounded-2xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 hover:from-peachDeep/90 hover:to-peach/90">
                    <span class="mr-2">âœ¨</span>í”„ë¡œí•„ ì €ì¥í•˜ê¸°
                </button>
                <a href="{{ url_for('index') }}" class="delete-btn px-6 py-4 border-2 border-gray-300 text-gray-600 font-medium rounded-2xl hover:border-red-300 hover:text-red-500 hover:bg-red-50 transition-all duration-300 text-center flex items-center justify-center">
                    <span class="mr-1">â†</span>ì·¨ì†Œ
                </a>
            </div>
        </form>
    </div>
  </main>

  <footer>
    <div>
      Â© <span id="year"></span> KBU hub Â· All rights reserved.
    </div>
  </footer>

  <script>
    // ì„±ë³„ ì„ íƒ í•¨ìˆ˜
    function selectGender(button) {
        const allGenderBtns = document.querySelectorAll('.gender-btn');
        allGenderBtns.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        // hidden inputì— ì„ íƒëœ ì„±ë³„ ì €ì¥
        document.getElementById('gender_input').value = button.dataset.gender;
    }

    // ì„ íƒëœ ê´€ì‹¬ì‚¬ ê°œìˆ˜ ì—…ë°ì´íŠ¸
    function updateSelectedCount() {
        const selectedCount = document.getElementById('selected-count');
        if (selectedCount) {
            const selected = document.querySelectorAll('.interest-checkbox:checked');
            selectedCount.textContent = selected.length;
        }
    }

    // ê¸°ì¡´ ìµëª… í”„ë¡œí•„ ë¡œë“œ
    function loadExistingProfile() {
        try {
            const profile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
            if (profile) {
                // í˜ì´ì§€ íƒ€ì´í‹€ ë³€ê²½ (ìˆ˜ì • ëª¨ë“œ)
                document.getElementById('pageTitle').textContent = 'ìµëª… í”„ë¡œí•„ ìˆ˜ì •';
                document.getElementById('pageDesc').textContent = 'ìµëª… í”„ë¡œí•„ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                
                // í•™ë²ˆ ì„ íƒ
                if (profile.year) {
                    document.getElementById('ap_year').value = profile.year;
                }
                
                // ì„±ë³„ ì„ íƒ
                if (profile.gender) {
                    const genderBtn = document.querySelector(`[data-gender="${profile.gender}"]`);
                    if (genderBtn) {
                        selectGender(genderBtn);
                    }
                }
                
                // ë‹‰ë„¤ì„ ì…ë ¥
                if (profile.nickname) {
                    const nicknameInput = document.getElementById('ap_nickname');
                    nicknameInput.value = profile.nickname;
                    document.getElementById('ap_nickname_count').textContent = profile.nickname.length;
                }
                
                // ìê¸°ì†Œê°œ ì…ë ¥
                if (profile.bio) {
                    const bioInput = document.getElementById('ap_bio');
                    bioInput.value = profile.bio;
                    document.getElementById('ap_count').textContent = profile.bio.length;
                }
                
                // ê´€ì‹¬ì‚¬ ì„ íƒ
                if (profile.interests && profile.interests.length > 0) {
                    profile.interests.forEach(interest => {
                        const checkbox = document.querySelector(`input[value="${interest}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            const label = checkbox.closest('.interest-chip');
                            label.classList.add('selected');
                        }
                    });
                    updateSelectedCount();
                }
            }
        } catch (e) {
            console.error('ê¸°ì¡´ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:', e);
        }
    }

    document.addEventListener('DOMContentLoaded', function(){
        // ë…„ë„ ì„¤ì •
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // ê¸°ì¡´ í”„ë¡œí•„ ë¡œë“œ
        loadExistingProfile();
        
        const form = document.getElementById('anon-form');
        const bio = document.getElementById('ap_bio');
        const count = document.getElementById('ap_count');
        const nickname = document.getElementById('ap_nickname');
        const nicknameCount = document.getElementById('ap_nickname_count');
        
        bio.addEventListener('input', ()=>{ count.textContent = bio.value.length; });
        nickname.addEventListener('input', ()=>{ nicknameCount.textContent = nickname.value.length; });
        
        // ê´€ì‹¬ì‚¬ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì‹œê°ì  í”¼ë“œë°±
        const checkboxes = document.querySelectorAll('.interest-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.closest('.interest-chip');
                if (this.checked) {
                    label.classList.add('selected');
                } else {
                    label.classList.remove('selected');
                }
                updateSelectedCount();
            });
        });

        // í¼ ì œì¶œ ì‹œ ìµœì†Œ 1ê°œ ê´€ì‹¬ì‚¬ ì„ íƒ ê²€ì¦
        form.addEventListener('submit', (e)=>{
            const selectedInterests = document.querySelectorAll('.interest-checkbox:checked');
            
            if (selectedInterests.length === 0) {
                e.preventDefault();
                alert('ê´€ì‹¬ì‚¬ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return false;
            }
        });

        // ëª¨ë°”ì¼ ë©”ë‰´ëŠ” navigation.jsì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤
    });
  </script>
  <script src="{{ url_for("static", filename="js/navigation.js") }}"></script>
</body>
</html>

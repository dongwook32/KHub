<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KBU hub | 마이페이지</title>
  <link rel="icon" href="{{ url_for("static", filename="images/logo.png") }}">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for("static", filename="css/nav.css") }}">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { peach: '#FFC8B2', peachDeep: '#FF9F80', cream: '#FFF7F2', cocoa:'#6B7280', ink:'#1F2937', mint:'#B7F4E6', lemon:'#FFF3A3' },
          boxShadow: { soft:'0 10px 30px rgba(255,159,128,.18)', glow:'0 0 0 0 rgba(255,159,128,.0)', card:'0 10px 24px rgba(17,24,39,.08)' },
          borderRadius: { bubble:'999px', xl2:'1.25rem' }
        }
      }
    }
  </script>
  <style>
    html, body { font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; }
    .top-grad{ background: radial-gradient(60% 60% at 0% 0%, #FFF0E7 0%, rgba(255,240,231,0) 60%), radial-gradient(60% 60% at 100% 0%, #FFE7DB 0%, rgba(255,231,219,0) 60%); }
    .glass{ background: rgba(255,255,255,.7); backdrop-filter: blur(10px); }
    /* 네비게이션 스타일은 nav.css (CSS Cascade Layers)에서 관리 */
    
    /* 헤더 크기 통일 및 흔들림 방지 */
    header {
        height: 80px !important;
        min-height: 80px !important;
        max-height: 80px !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 9999 !important;
        transform: translateZ(0) !important;
        backface-visibility: hidden !important;
        will-change: auto !important;
    }
    
    header > div:first-child {
        height: 100% !important;
        min-height: 100% !important;
        max-height: 100% !important;
        transform: translateZ(0) !important;
        padding: 12px 16px !important;
    }
    
    /* 헤더 스타일은 navigation.css에서 관리 */
    
    /* 익명카드, 계정, 내 활동 섹션 글씨 크기 증가 */
    .info-label, .info-value, .account-label, .account-value, .activity-label, .activity-count, .activity-recent {
        font-size: 15px !important;
    }
    
    .section-title {
        font-size: 18px !important;
    }
  </style>
  <link rel="stylesheet" href="{{ url_for("static", filename="css/mypage.css") }}">
  <style>
    .interest-chip.selected {
      background: linear-gradient(135deg, #FF9F80, #FFC8B2);
      border-color: #FF9F80;
      color: white;
    }
    .gender-btn.active {
      background: #f0f0f0;
      border-color: #FF9F80;
      border-width: 2px;
      color: #333;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge-secondary {
      background-color: #f1f5f9;
      color: #64748b;
      border: 1px solid #e2e8f0;
    }
    .activity-tabs {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 20px;
    }
    .activity-tab {
      padding: 12px 20px;
      border: none;
      background: none;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
    }
    .activity-tab.active {
      color: #FF9F80;
      border-bottom-color: #FF9F80;
      font-weight: 600;
    }
    .activity-tab-content {
      display: none;
    }
    .activity-tab-content.active {
      display: block;
    }
    .activity-list {
      max-height: 400px;
      overflow-y: auto;
    }
    .activity-item {
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 8px;
      background: #fafafa;
      position: relative;
    }
    .activity-item-clickable {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .activity-item-clickable:hover {
      background: #f0f9ff;
      border-color: #FF9F80;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 159, 128, 0.15);
    }
    .activity-item-arrow {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #FF9F80;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .activity-item-clickable:hover .activity-item-arrow {
      opacity: 1;
    }
    .activity-item-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .activity-item-content {
      color: #666;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .activity-item-meta {
      font-size: 12px;
      color: #999;
    }
    .activity-item-empty {
      text-align: center;
      color: #999;
      padding: 40px;
    }
    
    /* 통일된 Footer 스타일 */
    footer {
        border-top: 1px solid rgba(255, 200, 178, 0.5);
        margin-top: 0;
        padding: 0;
    }
    
    footer > div {
        max-width: 72rem;
        margin: 0 auto;
        padding: 1.5rem 1rem;
        font-size: 0.875rem;
        line-height: 1.25rem;
        color: #6B7280;
        text-align: center;
    }
    
    /* 이용 안내 링크 그리드 */
    .link-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      font-weight: 600;
      color: #374151;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
    }
    
    .link-card:hover {
      background: #FFF7F2;
      border-color: #FF9F80;
      color: #FF9F80;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 159, 128, 0.2);
    }
    
    /* 이용 안내 모달 내용 스타일 */
    #infoPanelContent p {
      margin: 0 0 12px 0;
      color: #374151;
      line-height: 1.6;
    }
    
    #infoPanelContent p:last-child {
      margin-bottom: 0;
    }
    
    #infoPanelContent .muted {
      color: #6B7280;
      font-size: 14px;
    }
  </style>
</head>
<body class="bg-cream">
  <div class="top-grad h-[160px] w-full absolute inset-0 -z-10 pointer-events-none"></div>

  <header class="fixed top-0 left-0 right-0 z-50 border-b border-peach/40 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
      <a href="{{ url_for('index') }}" class="flex items-center gap-2 font-extrabold text-lg">
        <img src="{{ url_for("static", filename="images/logo.png") }}" alt="KBU hub" class="w-9 h-9 rounded-full shadow-[0_8px_18px_rgba(255,159,128,.25)]">
        <span>hub</span>
      </a>
      <nav class="ml-auto hidden md:flex">
        <div id="navPill" class="nav-pill">
          <!-- 네비게이션 아이템은 navigation.js에서 동적으로 생성됩니다 -->
        </div>
      </nav>
      <button id="menuBtn" class="md:hidden ml-auto p-2 rounded-full border border-peach/60">☰</button>
    </div>
    <div id="mobileNav" class="hidden md:hidden px-4 pb-3 border-t border-peach/40 bg-white/70">
      <div class="flex flex-col gap-1 py-2 text-sm">
        <!-- 모바일 네비게이션 아이템은 navigation.js에서 동적으로 생성됩니다 -->
      </div>
    </div>
  </header>

  <!-- Flask Flash 메시지 표시 -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} flash-message" role="alert" style="position: fixed; top: 100px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; max-width: 600px; padding: 12px 16px; border-radius: 10px; transition: opacity 0.5s ease-out; {% if category == 'success' %}background-color: #d1fae5; color: #065f46; border: 1px solid #6ee7b7;{% elif category == 'error' %}background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5;{% else %}background-color: #dbeafe; color: #1e40af; border: 1px solid #93c5fd;{% endif %}">
          {{ message }}
          <button type="button" onclick="this.parentElement.style.display='none'" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer; line-height: 1; padding: 0; margin-left: 10px;">&times;</button>
        </div>
        <script>
          setTimeout(function() {
            const alertEl = document.querySelector('.alert.alert-{{ category }}');
            if (alertEl) {
              alertEl.style.opacity = '0';
              setTimeout(function() {
                alertEl.style.display = 'none';
              }, 500);
            }
          }, 3000);
        </script>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <main class="mx-auto max-w-6xl px-4 md:px-6 py-8 space-y-8" style="margin-top: 80px;">
    <!-- 상단 히어로 섹션 -->
    <div class="hero-summary">
      <div class="hero-bg-blur hero-bg-blur-1"></div>
      <div class="hero-bg-blur hero-bg-blur-2"></div>
      <div class="hero-content">
        <div class="hero-avatar">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400">
            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <div class="hero-info">
          <div class="hero-title">내 정보</div>
          <div class="hero-name">
            <span id="userName"></span>
          </div>
          <div class="hero-details">
            <span id="userDept">한국성서대</span>
          </div>
          <div class="hero-details">
            <span id="userStudentId"></span>학번 · <span id="userStatus"></span>
          </div>
          <div class="hero-intro" id="userIntro"></div>
        </div>
        <div class="hero-actions">
          <button class="btn btn-destructive" onclick="handleLogout()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            로그아웃
          </button>
        </div>
      </div>
    </div>

    <!-- 섹션 1: 프로필 & 익명카드 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">익명카드</div>
        <button class="btn btn-outline btn-sm" onclick="openModal('profileModal')">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
          수정
        </button>
      </div>
      <div class="section-content">
        <div class="info-item">
          <div class="info-label">닉네임</div>
          <div class="info-value" id="anonNickname">익명카드가 설정되지 않았습니다.</div>
        </div>
        <div class="info-item">
          <div class="info-label">학번</div>
          <div class="info-value" id="anonYear">-</div>
          </div>
        <div class="info-item">
          <div class="info-label">성별</div>
          <div class="info-value" id="anonGender">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">자기소개</div>
          <div class="info-value" id="anonBio">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">관심사</div>
          <div class="interests-list" id="anonInterests">
            <span class="text-gray-500">선택된 관심사가 없습니다.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 섹션 2: 계정 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">계정</div>
        <button class="btn btn-outline btn-sm" onclick="openModal('accountModal')">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          비밀번호 변경
        </button>
      </div>
      <div class="account-grid">
        <div class="account-card">
          <div class="account-label">이름</div>
          <div class="account-value" id="accountName"></div>
        </div>
        <div class="account-card">
          <div class="account-label">학번</div>
          <div class="account-value" id="accountStudentId"></div>
        </div>
        <div class="account-card">
          <div class="account-label">생일</div>
          <div class="account-value" id="accountBirthday"></div>
        </div>
        <div class="account-card">
          <div class="account-label">성별</div>
          <div class="account-value" id="accountGender"></div>
        </div>
        <div class="account-card">
          <div class="account-label">재학 상태</div>
          <div class="account-value" id="accountStatus"></div>
        </div>
        <div class="account-card">
          <div class="account-label">이메일</div>
          <div class="account-value" id="accountEmail"></div>
        </div>
      </div>
    </div>

    <!-- 섹션 3: 내 활동 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">내 활동</div>
        <button class="btn btn-outline btn-sm" onclick="openModal('activityModal')">
          더 보기
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </button>
      </div>
      <div class="activity-grid">
        <div class="activity-card">
          <div class="activity-label">내 글</div>
          <div class="activity-count" id="myPostsCount">0</div>
          <div class="activity-recent" id="myPostsRecent">작성한 글이 없습니다.</div>
        </div>
        <div class="activity-card">
          <div class="activity-label">내 댓글</div>
          <div class="activity-count" id="myCommentsCount">0</div>
          <div class="activity-recent" id="myCommentsRecent">작성한 댓글이 없습니다.</div>
        </div>
        <div class="activity-card">
          <div class="activity-label">좋아요한 글</div>
          <div class="activity-count" id="myLikesCount">0</div>
          <div class="activity-recent" id="myLikesRecent">좋아요한 글이 없습니다.</div>
        </div>
        <div class="activity-card">
          <div class="activity-label">좋아요한 댓글</div>
          <div class="activity-count" id="myCommentLikesCount">0</div>
          <div class="activity-recent" id="myCommentLikesRecent">좋아요한 댓글이 없습니다.</div>
        </div>
      </div>
    </div>

    <!-- 섹션 4: 이용 안내 & 기타 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">이용 안내</div>
      </div>
      <div class="links-grid">
        <button class="link-card" data-key="contact" onclick="showInfoPanel('contact')">문의하기</button>
        <button class="link-card" data-key="notice" onclick="showInfoPanel('notice')">공지사항</button>
        <button class="link-card" data-key="tos" onclick="showInfoPanel('tos')">서비스 이용약관</button>
        <button class="link-card" data-key="privacy" onclick="showInfoPanel('privacy')">개인정보 처리방침</button>
        <button class="link-card" data-key="youth" onclick="showInfoPanel('youth')">청소년 보호 정책</button>
        <button class="link-card" data-key="consent" onclick="showInfoPanel('consent')">정보 동의 설정</button>
      </div>
      
      <div class="footer-actions">
        <div class="copyright">© 2025 KBU Hub</div>
        <button class="btn btn-destructive" onclick="openModal('deleteModal')">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
          회원 탈퇴
        </button>
      </div>
    </div>
  </main>

  <!-- 프로필 수정 모달 -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">프로필 수정</div>
        <button class="modal-close" onclick="closeModal('profileModal')">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>닉네임</label>
          <input id="editAnonNickname" type="text" placeholder="닉네임을 입력하세요" maxlength="10">
        </div>
        <div class="form-group">
          <label>학번</label>
          <select id="editAnonYear">
            <option value="">선택해주세요</option>
            <option value="25학번">25학번</option>
            <option value="24학번">24학번</option>
            <option value="23학번">23학번</option>
            <option value="22학번">22학번</option>
            <option value="21학번">21학번</option>
          </select>
        </div>
        <div class="form-group">
          <label>성별</label>
          <div class="flex gap-2">
            <button type="button" class="gender-btn flex-1 py-2 px-4 border rounded" data-gender="남자" onclick="selectAnonGender(this)">남자</button>
            <button type="button" class="gender-btn flex-1 py-2 px-4 border rounded" data-gender="여자" onclick="selectAnonGender(this)">여자</button>
          </div>
        </div>
        <div class="form-group">
          <label>자기소개</label>
          <textarea id="editAnonBio" rows="4" placeholder="자기소개를 입력하세요" maxlength="100"></textarea>
        </div>
        <div class="form-group">
          <label>관심사</label>
          <div id="editAnonInterests" class="flex flex-wrap gap-2">
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="영화" onclick="toggleAnonInterest(this)">영화</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="운동" onclick="toggleAnonInterest(this)">운동</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="게임" onclick="toggleAnonInterest(this)">게임</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="음악" onclick="toggleAnonInterest(this)">음악</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="카페" onclick="toggleAnonInterest(this)">카페</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="여행" onclick="toggleAnonInterest(this)">여행</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="스터디" onclick="toggleAnonInterest(this)">스터디</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="독서" onclick="toggleAnonInterest(this)">독서</button>
            <button type="button" class="interest-chip px-3 py-1 border rounded-full text-sm" data-value="맛집" onclick="toggleAnonInterest(this)">맛집</button>
        </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveAnonProfile()">저장</button>
      </div>
    </div>
  </div>

  <!-- 비밀번호 변경 모달 -->
  <div id="accountModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">비밀번호 변경</div>
        <button class="modal-close" onclick="closeModal('accountModal')">×</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>현재 비밀번호</label>
          <input type="password" id="currentPassword" placeholder="현재 비밀번호를 입력하세요">
        </div>
        <div class="form-group">
          <label>새 비밀번호</label>
          <input type="password" id="newPassword" placeholder="새 비밀번호를 입력하세요">
        </div>
        <div class="form-group">
          <label>새 비밀번호 확인</label>
          <input type="password" id="confirmPassword" placeholder="새 비밀번호를 다시 입력하세요">
        </div>
        <div class="text-xs text-muted-foreground">8자 이상, 영문/숫자 조합 권장</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="changePassword()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          변경
        </button>
      </div>
    </div>
  </div>

  <!-- 정보 동의 설정 모달 -->
  <div id="consentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">정보 동의 설정</div>
        <button class="modal-close" onclick="closeModal('consentModal')">×</button>
      </div>
      <div class="modal-body">
        <div class="consent-item">
          <span>마케팅 이메일 수신</span>
          <label class="switch">
            <input type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="consent-item">
          <span>알림 푸시 수신</span>
          <label class="switch">
            <input type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="consent-item">
          <span>익명 데이터 통계 활용</span>
          <label class="switch">
            <input type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeModal('consentModal')">저장</button>
      </div>
    </div>
  </div>

  <!-- 회원 탈퇴 모달 -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">정말 탈퇴하시겠어요?</div>
        <button class="modal-close" onclick="closeModal('deleteModal')">×</button>
      </div>
      <div class="modal-body">
        <p class="text-sm text-muted-foreground">게시판에 남긴 글/댓글은 운영정책에 따라 익명화 처리되며, 계정 정보는 복구되지 않습니다.</p>
        <p class="text-sm text-muted-foreground" style="margin-top: 8px; color: #ef4444; font-weight: 600;">⚠️ 모든 데이터가 영구적으로 삭제되며 복구할 수 없습니다.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('deleteModal')">취소</button>
        <button class="btn btn-destructive" onclick="handleDeleteAccount()">탈퇴 진행</button>
      </div>
    </div>
  </div>

  <!-- 이용 안내 모달 -->
  <div id="infoModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <div class="modal-title" id="infoPanelTitle"></div>
        <button class="modal-close" onclick="closeInfoPanel()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="infoPanelContent"></div>
      </div>
    </div>
  </div>

  <!-- 내 활동 상세 모달 -->
  <div id="activityModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <div class="modal-title">내 활동 상세</div>
        <button class="modal-close" onclick="closeModal('activityModal')">×</button>
      </div>
      <div class="modal-body">
        <div class="activity-tabs">
          <button class="activity-tab active" onclick="showActivityTab('posts')">내 글</button>
          <button class="activity-tab" onclick="showActivityTab('comments')">내 댓글</button>
          <button class="activity-tab" onclick="showActivityTab('likes')">좋아요한 글</button>
          <button class="activity-tab" onclick="showActivityTab('commentLikes')">좋아요한 댓글</button>
        </div>
        
        <div id="postsTab" class="activity-tab-content active">
          <div class="activity-list" id="myPostsList">
            <div class="activity-item-empty">작성한 글이 없습니다.</div>
          </div>
        </div>
        
        <div id="commentsTab" class="activity-tab-content">
          <div class="activity-list" id="myCommentsList">
            <div class="activity-item-empty">작성한 댓글이 없습니다.</div>
          </div>
        </div>
        
        <div id="likesTab" class="activity-tab-content">
          <div class="activity-list" id="myLikesList">
            <div class="activity-item-empty">좋아요한 글이 없습니다.</div>
          </div>
        </div>
        
        <div id="commentLikesTab" class="activity-tab-content">
          <div class="activity-list" id="myCommentLikesList">
            <div class="activity-item-empty">좋아요한 댓글이 없습니다.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>
      © <span id="year"></span> KBU hub · All rights reserved.
    </div>
  </footer>

  <script src="{{ url_for("static", filename="js/script.js") }}"></script>
  <script>
    // 모바일 메뉴는 navigation.js에서 처리됩니다

    // 모달 닫기
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // 모달 외부 클릭시 닫기
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    // 익명카드 정보 로드
    function loadAnonProfile() {
      try {
        const anonProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
        if (anonProfile) {
          document.getElementById('anonNickname').textContent = anonProfile.nickname || '익명의친구';
          document.getElementById('anonYear').textContent = anonProfile.year || '-';
          document.getElementById('anonGender').textContent = anonProfile.gender || '-';
          document.getElementById('anonBio').textContent = anonProfile.bio || '-';
          
          // 관심사 표시
          const interestsContainer = document.getElementById('anonInterests');
          if (anonProfile.interests && anonProfile.interests.length > 0) {
            const interestsHTML = anonProfile.interests.map(interest => 
              `<span class="badge badge-secondary">#${interest}</span>`
            ).join('');
            interestsContainer.innerHTML = interestsHTML;
          } else {
            interestsContainer.innerHTML = '<span class="text-gray-500">선택된 관심사가 없습니다.</span>';
          }
        }
      } catch (e) {
        console.error('익명카드 로드 실패:', e);
      }
    }

    // 성별 선택 함수
    function selectAnonGender(button) {
      const allGenderBtns = document.querySelectorAll('.gender-btn');
      allGenderBtns.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    }

    // 관심사 토글 함수
    function toggleAnonInterest(button) {
      button.classList.toggle('selected');
    }

    // 닉네임 중복 검사 함수 (서버 API 사용)
    async function isNicknameAvailable(nickname) {
      if (!nickname || nickname.trim() === '') {
        return true;
      }
      
      try {
        const response = await fetch("{{ url_for('check_nickname') }}", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ nickname: nickname.trim() })
        });
        
        const result = await response.json();
        return result.available;
      } catch (error) {
        console.error('닉네임 중복 체크 실패:', error);
        return true; // 오류 시 진행 허용
      }
    }

    // 익명카드 저장
    async function saveAnonProfile() {
      const nickname = document.getElementById('editAnonNickname').value.trim() || '익명의친구';
      const year = document.getElementById('editAnonYear').value;
      const gender = document.querySelector('.gender-btn.active')?.dataset.gender || '남자';
      const bio = document.getElementById('editAnonBio').value.trim();
      const interests = Array.from(document.querySelectorAll('.interest-chip.selected')).map(chip => chip.dataset.value);
      
      if (!year) {
        alert('학번을 선택해주세요.');
        return;
      }
      
      if (interests.length === 0) {
        alert('관심사를 최소 1개 이상 선택해주세요.');
        return;
      }
      
      // 닉네임 중복 검증
      if (nickname) {
        const available = await isNicknameAvailable(nickname);
        if (!available) {
          alert('이미 사용 중인 닉네임입니다. 다른 닉네임을 입력해주세요!');
          document.getElementById('editAnonNickname').focus();
          return;
        }
      }
      
      const anonProfile = { 
        nickname, 
        year, 
        gender, 
        bio, 
        interests,
        avatar: nickname[0] || '익'
      };
      
      try {
        // 서버에 익명 프로필 저장
        const response = await fetch("{{ url_for('save_anon_profile_api') }}", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(anonProfile)
        });
        
        const result = await response.json();
        
        if (result.success) {
          // localStorage에도 저장
          localStorage.setItem('anonProfile', JSON.stringify(anonProfile));
          
          loadAnonProfile(); // UI 업데이트
          closeModal('profileModal');
          alert('익명카드가 저장되었습니다.');
        } else {
          alert(result.message || '익명카드 저장 중 오류가 발생했습니다.');
        }
      } catch (error) {
        console.error('익명카드 저장 실패:', error);
        alert('익명카드 저장 중 오류가 발생했습니다. 다시 시도해주세요.');
      }
    }

    // 모달 열 때 기존 데이터 로드
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
      
      if (modalId === 'profileModal') {
        const anonProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
        if (anonProfile) {
          document.getElementById('editAnonNickname').value = anonProfile.nickname || '';
          document.getElementById('editAnonYear').value = anonProfile.year || '';
          document.getElementById('editAnonBio').value = anonProfile.bio || '';
          
          // 성별 선택 복원
          const genderBtns = document.querySelectorAll('.gender-btn');
          genderBtns.forEach(btn => btn.classList.remove('active'));
          const selectedGenderBtn = document.querySelector(`[data-gender="${anonProfile.gender}"]`);
          if (selectedGenderBtn) selectedGenderBtn.classList.add('active');
          
          // 관심사 선택 복원
          const interestChips = document.querySelectorAll('.interest-chip');
          interestChips.forEach(chip => chip.classList.remove('selected'));
          if (anonProfile.interests) {
            anonProfile.interests.forEach(interest => {
              const chip = document.querySelector(`[data-value="${interest}"]`);
              if (chip) chip.classList.add('selected');
            });
          }
          
          // 닉네임 실시간 검증 이벤트 리스너 추가
          const nicknameInput = document.getElementById('editAnonNickname');
          let nicknameCheckTimeout = null;
          
          nicknameInput.addEventListener('input', function() {
            const nicknameValue = this.value.trim();
            
            // 디바운싱 적용
            clearTimeout(nicknameCheckTimeout);
            nicknameCheckTimeout = setTimeout(async () => {
              const nicknameError = document.getElementById('nickname-error-modal');
              
              if (nicknameValue) {
                const available = await isNicknameAvailable(nicknameValue);
                
                if (!available) {
                  if (!nicknameError) {
                    const errorDiv = document.createElement('div');
                    errorDiv.id = 'nickname-error-modal';
                    errorDiv.className = 'text-red-500 text-sm mt-1';
                    errorDiv.innerHTML = '⚠️ 이미 사용 중인 닉네임입니다.';
                    this.parentNode.appendChild(errorDiv);
                  }
                  this.style.borderColor = '#ef4444';
                } else {
                  if (nicknameError) {
                    nicknameError.remove();
                  }
                  this.style.borderColor = '#10b981';
                }
              } else {
                if (nicknameError) {
                  nicknameError.remove();
                }
                this.style.borderColor = '';
              }
            }, 500);
          });
        }
      }
    }

    // 회원가입 정보 로드
    function loadUserProfile() {
      try {
        const userProfile = JSON.parse(localStorage.getItem('userProfile') || 'null');
        if (userProfile) {
          // 내 정보 섹션 업데이트
          document.getElementById('userName').textContent = userProfile.name || '사용자';
          document.getElementById('userDept').textContent = '한국성서대'; // 고정값
          document.getElementById('userStudentId').textContent = userProfile.studentId || '2022';
          document.getElementById('userStatus').textContent = userProfile.status || '재학생';
          
          // 계정 섹션 업데이트
          document.getElementById('accountName').textContent = userProfile.name || '사용자';
          document.getElementById('accountStudentId').textContent = userProfile.studentId || '2022';
          document.getElementById('accountBirthday').textContent = userProfile.birthday || '1999-01-01';
          document.getElementById('accountGender').textContent = userProfile.gender || '남자';
          document.getElementById('accountStatus').textContent = userProfile.status || '재학생';
          document.getElementById('accountEmail').textContent = userProfile.email || 'user@bible.ac.kr';
        } else {
          // 사용자 프로필이 없는 경우에도 한국성서대는 고정 표시
          document.getElementById('userDept').textContent = '한국성서대';
        }
      } catch (e) {
        console.error('사용자 프로필 로드 실패:', e);
        // 오류 발생 시에도 한국성서대는 고정 표시
        document.getElementById('userDept').textContent = '한국성서대';
      }
    }

    // 회원가입 정보 저장 (회원가입 페이지에서 호출될 함수)
    function saveUserProfile(profileData) {
      try {
        localStorage.setItem('userProfile', JSON.stringify(profileData));
        loadUserProfile(); // UI 업데이트
        console.log('사용자 프로필 저장 완료:', profileData);
      } catch (e) {
        console.error('사용자 프로필 저장 실패:', e);
      }
    }

    // 비밀번호 변경 함수
    async function changePassword() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      // 입력값 검증
      if (!currentPassword || !newPassword || !confirmPassword) {
        alert('모든 필드를 입력해주세요.');
        return;
      }
      
      // 새 비밀번호 확인
      if (newPassword !== confirmPassword) {
        alert('새 비밀번호가 일치하지 않습니다.');
        return;
      }
      
      // 비밀번호 강도 검증 (8자 이상, 영문/숫자 조합)
      const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;
      if (!passwordRegex.test(newPassword)) {
        alert('비밀번호는 8자 이상, 영문과 숫자를 포함해야 합니다.');
        return;
      }
      
      try {
        // 서버에 비밀번호 변경 요청
        const response = await fetch("{{ url_for('change_password') }}", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            current_password: currentPassword,
            new_password: newPassword
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // 입력 필드 초기화
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
          
          // 모달 닫기
          closeModal('accountModal');
          
          // 성공 메시지
          alert(result.message);
        } else {
          // 오류 메시지 표시
          alert(result.message);
        }
        
      } catch (error) {
        console.error('비밀번호 변경 실패:', error);
        alert('비밀번호 변경 중 오류가 발생했습니다. 다시 시도해주세요.');
      }
    }

    // 내 활동 데이터 관리
    function getMyActivity() {
      try {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) return { posts: [], comments: [], likes: [], commentLikes: [] };
        
        const activity = JSON.parse(localStorage.getItem(`activity_${currentUser}`) || '{"posts":[],"comments":[],"likes":[],"commentLikes":[]}');
        return activity;
      } catch (e) {
        console.error('활동 데이터 로드 실패:', e);
        return { posts: [], comments: [], likes: [], commentLikes: [] };
      }
    }

    function saveMyActivity(activity) {
      try {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) return;
        
        localStorage.setItem(`activity_${currentUser}`, JSON.stringify(activity));
      } catch (e) {
        console.error('활동 데이터 저장 실패:', e);
      }
    }

    // 게시글 작성 시 호출할 함수 (게시판에서 사용)
    function addMyPost(postData) {
      const activity = getMyActivity();
      const post = {
        id: Date.now(),
        title: postData.title,
        content: postData.content,
        category: postData.category || '일반',
        date: new Date().toISOString(),
        likes: 0
      };
      activity.posts.unshift(post);
      saveMyActivity(activity);
      loadMyActivity();
    }

    // 댓글 작성 시 호출할 함수 (게시판에서 사용)
    function addMyComment(commentData) {
      const activity = getMyActivity();
      const comment = {
        id: Date.now(),
        content: commentData.content,
        postTitle: commentData.postTitle,
        postId: commentData.postId,
        date: new Date().toISOString()
      };
      activity.comments.unshift(comment);
      saveMyActivity(activity);
      loadMyActivity();
    }

    // 좋아요 추가/제거 시 호출할 함수 (게시판에서 사용)
    function toggleMyLike(postData) {
      const activity = getMyActivity();
      const existingIndex = activity.likes.findIndex(like => like.postId === postData.id);
      
      if (existingIndex >= 0) {
        // 좋아요 제거
        activity.likes.splice(existingIndex, 1);
      } else {
        // 좋아요 추가
        const like = {
          id: Date.now(),
          postId: postData.id,
          postTitle: postData.title,
          postAuthor: postData.author,
          date: new Date().toISOString()
        };
        activity.likes.unshift(like);
      }
      saveMyActivity(activity);
      loadMyActivity();
    }

    // 댓글 좋아요 추가/제거 시 호출할 함수 (게시판에서 사용)
    function toggleMyCommentLike(commentData) {
      const activity = getMyActivity();
      const existingIndex = activity.commentLikes.findIndex(like => like.commentId === commentData.id);
      
      if (existingIndex >= 0) {
        // 좋아요 제거
        activity.commentLikes.splice(existingIndex, 1);
      } else {
        // 좋아요 추가
        const like = {
          id: Date.now(),
          commentId: commentData.id,
          commentContent: commentData.content,
          commentAuthor: commentData.author,
          postId: commentData.postId,
          date: new Date().toISOString()
        };
        activity.commentLikes.unshift(like);
      }
      saveMyActivity(activity);
      loadMyActivity();
    }

    // 내 활동 정보 로드 및 UI 업데이트
    function loadMyActivity() {
      const activity = getMyActivity();
      
      // 카운트 업데이트
      document.getElementById('myPostsCount').textContent = activity.posts.length;
      document.getElementById('myCommentsCount').textContent = activity.comments.length;
      document.getElementById('myLikesCount').textContent = activity.likes.length;
      document.getElementById('myCommentLikesCount').textContent = activity.commentLikes.length;
      
      // 최근 활동 업데이트
      if (activity.posts.length > 0) {
        const recentPost = activity.posts[0];
        document.getElementById('myPostsRecent').textContent = `최근: "${recentPost.title}"`;
      } else {
        document.getElementById('myPostsRecent').textContent = '작성한 글이 없습니다.';
      }
      
      if (activity.comments.length > 0) {
        const recentComment = activity.comments[0];
        const shortContent = recentComment.content.length > 20 ? 
          recentComment.content.substring(0, 20) + '...' : recentComment.content;
        document.getElementById('myCommentsRecent').textContent = `최근: "${shortContent}"`;
      } else {
        document.getElementById('myCommentsRecent').textContent = '작성한 댓글이 없습니다.';
      }
      
      if (activity.likes.length > 0) {
        const recentLike = activity.likes[0];
        document.getElementById('myLikesRecent').textContent = `최근: "${recentLike.postTitle}"`;
      } else {
        document.getElementById('myLikesRecent').textContent = '좋아요한 글이 없습니다.';
      }
      
      if (activity.commentLikes.length > 0) {
        const recentCommentLike = activity.commentLikes[0];
        const shortContent = recentCommentLike.commentContent.length > 20 ? 
          recentCommentLike.commentContent.substring(0, 20) + '...' : recentCommentLike.commentContent;
        document.getElementById('myCommentLikesRecent').textContent = `최근: "${shortContent}"`;
      } else {
        document.getElementById('myCommentLikesRecent').textContent = '좋아요한 댓글이 없습니다.';
      }
    }

    // 활동 탭 전환
    function showActivityTab(tabName) {
      // 모든 탭 비활성화
      document.querySelectorAll('.activity-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.activity-tab-content').forEach(content => content.classList.remove('active'));
      
      // 선택된 탭 활성화
      event.target.classList.add('active');
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // 해당 탭 내용 로드
      loadActivityTabContent(tabName);
    }

    // 활동 탭 내용 로드
    function loadActivityTabContent(tabName) {
      const activity = getMyActivity();
      let listElement, items, emptyMessage;
      
      switch(tabName) {
        case 'posts':
          listElement = document.getElementById('myPostsList');
          items = activity.posts;
          emptyMessage = '작성한 글이 없습니다.';
          break;
        case 'comments':
          listElement = document.getElementById('myCommentsList');
          items = activity.comments;
          emptyMessage = '작성한 댓글이 없습니다.';
          break;
        case 'likes':
          listElement = document.getElementById('myLikesList');
          items = activity.likes;
          emptyMessage = '좋아요한 글이 없습니다.';
          break;
        case 'commentLikes':
          listElement = document.getElementById('myCommentLikesList');
          items = activity.commentLikes;
          emptyMessage = '좋아요한 댓글이 없습니다.';
          break;
      }
      
      if (items.length === 0) {
        listElement.innerHTML = `<div class="activity-item-empty">${emptyMessage}</div>`;
        return;
      }
      
      let html = '';
      items.forEach(item => {
        const date = new Date(item.date).toLocaleDateString('ko-KR');
        
        if (tabName === 'posts') {
          html += `
            <div class="activity-item activity-item-clickable" onclick="navigateToPost('${item.id}', 'mypost')">
              <div class="activity-item-title">${item.title}</div>
              <div class="activity-item-content">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</div>
              <div class="activity-item-meta">${item.category} · ${date} · 좋아요 ${item.likes}</div>
              <div class="activity-item-arrow">→</div>
            </div>
          `;
        } else if (tabName === 'comments') {
          html += `
            <div class="activity-item activity-item-clickable" onclick="navigateToPost('${item.postId}', 'comment', '${item.id}')">
              <div class="activity-item-title">댓글: ${item.postTitle}</div>
              <div class="activity-item-content">${item.content}</div>
              <div class="activity-item-meta">${date}</div>
              <div class="activity-item-arrow">→</div>
            </div>
          `;
        } else if (tabName === 'likes') {
          html += `
            <div class="activity-item activity-item-clickable" onclick="navigateToPost('${item.postId}', 'like')">
              <div class="activity-item-title">${item.postTitle}</div>
              <div class="activity-item-content">작성자: ${item.postAuthor}</div>
              <div class="activity-item-meta">${date}</div>
              <div class="activity-item-arrow">→</div>
            </div>
          `;
        } else if (tabName === 'commentLikes') {
          html += `
            <div class="activity-item activity-item-clickable" onclick="navigateToPost('${item.postId}', 'commentLike', '${item.commentId}')">
              <div class="activity-item-title">댓글 좋아요: ${item.commentContent}</div>
              <div class="activity-item-content">작성자: ${item.commentAuthor}</div>
              <div class="activity-item-meta">${date}</div>
              <div class="activity-item-arrow">→</div>
            </div>
          `;
        }
      });
      
      listElement.innerHTML = html;
    }

    // 모달 열기 시 활동 탭 내용 로드
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
      
      if (modalId === 'profileModal') {
        const anonProfile = JSON.parse(localStorage.getItem('anonProfile') || 'null');
        if (anonProfile) {
          document.getElementById('editAnonNickname').value = anonProfile.nickname || '';
          document.getElementById('editAnonYear').value = anonProfile.year || '';
          document.getElementById('editAnonBio').value = anonProfile.bio || '';
          
          // 성별 선택 복원
          const genderBtns = document.querySelectorAll('.gender-btn');
          genderBtns.forEach(btn => btn.classList.remove('active'));
          const selectedGenderBtn = document.querySelector(`[data-gender="${anonProfile.gender}"]`);
          if (selectedGenderBtn) selectedGenderBtn.classList.add('active');
          
          // 관심사 선택 복원
          const interestChips = document.querySelectorAll('.interest-chip');
          interestChips.forEach(chip => chip.classList.remove('selected'));
          if (anonProfile.interests) {
            anonProfile.interests.forEach(interest => {
              const chip = document.querySelector(`[data-value="${interest}"]`);
              if (chip) chip.classList.add('selected');
            });
          }
        }
      } else if (modalId === 'activityModal') {
        // 첫 번째 탭(내 글) 내용 로드
        loadActivityTabContent('posts');
      }
    }

    // 게시판으로 이동하는 함수
    function navigateToPost(postId, type, commentId = null) {
      // URL 파라미터 생성
      const params = new URLSearchParams();
      params.set('postId', postId);
      params.set('source', 'mypage');
      params.set('type', type);
      
      if (commentId) {
        params.set('commentId', commentId);
      }
      
      // 게시판 페이지로 이동
      const boardUrl = `boards.html?${params.toString()}`;
      
      // 새 탭에서 열기 (선택사항)
      // window.open(boardUrl, '_blank');
      
      // 같은 탭에서 이동
      window.location.href = '/boards';
      
      console.log(`게시판으로 이동: ${boardUrl}`);
    }

    // 게시판에서 사용할 수 있는 URL 파라미터 파싱 함수
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        postId: params.get('postId'),
        source: params.get('source'),
        type: params.get('type'),
        commentId: params.get('commentId')
      };
    }

    // 페이지 로드 시 정보 표시
    document.addEventListener('DOMContentLoaded', function() {
      // 년도 설정
      document.getElementById('year').textContent = new Date().getFullYear();
      
      // Flask 세션에서 사용자 정보를 localStorage에 저장
      {% if session.user %}
      try {
        const sessionUser = {
          name: "{{ session.user.name }}",
          studentId: "{{ session.user.student_id }}",
          birthday: "{{ session.user.birthday }}",
          gender: "{{ session.user.gender }}",
          status: "{{ session.user.status }}",
          email: "{{ session.user.email }}"
        };
        
        // currentUser 설정 (로그인한 사용자의 학번)
        localStorage.setItem('currentUser', sessionUser.studentId);
        
        // userProfile 저장 (마이페이지 표시용)
        localStorage.setItem('userProfile', JSON.stringify(sessionUser));
        
        console.log('로그인 사용자 정보가 localStorage에 저장되었습니다:', sessionUser);
      } catch (e) {
        console.error('사용자 정보 localStorage 저장 실패:', e);
      }
      {% endif %}
      
      // 서버에서 받은 익명 프로필이 있으면 localStorage에 저장
      {% if anon_profile %}
      const serverAnonProfile = {{ anon_profile|tojson }};
      if (serverAnonProfile && Object.keys(serverAnonProfile).length > 0) {
        localStorage.setItem('anonProfile', JSON.stringify(serverAnonProfile));
        console.log('서버 익명 프로필을 localStorage에 저장:', serverAnonProfile);
      }
      {% endif %}
      
      loadAnonProfile();
      loadUserProfile();
      loadMyActivity();
    });

    // 로그아웃
    function handleLogout() {
      if (confirm('로그아웃하시겠습니까?')) {
        // localStorage 초기화
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('userProfile');
        // 주의: anonProfile과 activity는 유지 (다음 로그인 시 사용 가능)
        
        // 서버 로그아웃 처리
        window.location.href = "{{ url_for('logout') }}";
      }
    }

    // 회원 탈퇴
    async function handleDeleteAccount() {
      try {
        // 최종 확인
        const confirmed = confirm('정말로 회원 탈퇴하시겠습니까? 모든 데이터가 영구적으로 삭제됩니다.');
        if (!confirmed) {
          return;
        }
        
        // 서버에 탈퇴 요청
        const response = await fetch("{{ url_for('delete_account') }}", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.success) {
          // localStorage의 모든 데이터 삭제
          const currentUser = localStorage.getItem('currentUser');
          if (currentUser) {
            // 사용자별 데이터 삭제
            localStorage.removeItem(`activity_${currentUser}`);
            localStorage.removeItem('anonProfile');
            localStorage.removeItem('userProfile');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isLoggedIn');
          }
          
          // 기타 관련 데이터 삭제
          const keysToRemove = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && (key.startsWith('activity_') || key.includes('user') || key.includes('profile'))) {
              keysToRemove.push(key);
            }
          }
          keysToRemove.forEach(key => localStorage.removeItem(key));
          
          // 모달 닫기
          closeModal('deleteModal');
          
          // 성공 메시지 표시
          alert(result.message);
          
          // 홈페이지로 리디렉트
          window.location.href = result.redirect || "{{ url_for('index') }}";
        } else {
          alert(result.message || '회원 탈퇴 중 오류가 발생했습니다.');
        }
      } catch (error) {
        console.error('회원 탈퇴 오류:', error);
        alert('회원 탈퇴 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
      }
    }

    // 이용 안내 내용 데이터
    const infoData = {
      contact: {
        title: '문의하기',
        content: `
          <p>서비스 이용 중 궁금한 점이 있다면 아래 채널로 문의해 주세요.</p>
          <p class="muted">이메일: an5192@bible.ac.kr · 운영시간: 평일 09:00–18:00</p>
        `
      },
      notice: {
        title: '공지사항',
        content: `
          <p>업데이트 및 점검 일정을 안내드립니다.</p>
          <p class="muted">중요 공지는 마이페이지 > 알림에도 표시됩니다.</p>
        `
      },
      tos: {
        title: '서비스 이용약관',
        content: `
          <div id="tosSummary">
            <p style="margin-bottom: 4px;">서비스 사용을 위한 기본 규정과 회원의 권리·의무를 규정합니다.</p>
            <p class="muted" style="margin-bottom: 4px;">자세한 전문은 '전체 약관 보기'에서 확인해 주세요.</p>
            <button onclick="toggleTosDetail()" style="margin-top: 12px; padding: 8px 16px; background: linear-gradient(135deg, #FF9F80, #FFC8B2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              전체 내용 보기
            </button>
          </div>
          <div id="tosDetail" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <h4 style="font-size: 16px; font-weight: 700; color: #1F2937; margin: 0 0 8px 0;">서비스 이용약관 전문</h4>
            <p style="font-size: 12px; color: #6B7280; margin-bottom: 8px; font-style: italic;">↓ 아래로 스크롤하여 전체 내용을 확인하세요</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">1. 목적</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">본 약관은 (주식회사 ○○○)(이하 "회사")가 제공하는 (KBU Hub) 서비스(이하 "서비스")의 이용과 관련하여 회사와 회원 간의 권리·의무 및 책임사항, 기타 필요한 사항을 규정함을 목적으로 합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">2. 용어의 정의</h5>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>"회원":</strong> 약관에 동의하고 계정을 생성하여 서비스를 이용하는 자</p>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>"비회원":</strong> 계정 없이 일부 서비스를 이용하는 자</p>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>"콘텐츠":</strong> 서비스 상에 게시·전송되는 글, 이미지, 영상, 파일 등 일체</p>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>"유료서비스":</strong> 유상으로 제공되는 구독·아이템 등</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">3. 약관의 게시와 개정</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 약관을 서비스 내에 게시합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 관련 법령 개정 또는 서비스 정책 변경 시 약관을 개정할 수 있으며, 중요 변경은 시행 최소 7일 전(회원에게 불리한 경우 30일 전) 공지합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 변경 효력 발생일 이후에도 서비스를 계속 이용하면 개정 약관에 동의한 것으로 봅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">4. 약관 외 준칙</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">약관에 명시되지 않은 사항은 관련 법령, 개인정보 처리방침, 개별 운영정책 및 안내에 따릅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">5. 회원가입 및 계정</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회원은 회사가 정한 절차에 따라 가입하며, 학번/학교 이메일 등 실제 정보를 정확히 제공해야 합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 14세 미만은 법정대리인 동의가 필요합니다. (서비스 특성상 대상 제한 시 "청소년 이용 제한"을 명시)</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 계정 보안은 회원 책임이며, 제3자 이용을 허용할 수 없습니다. 이상 사용 발견 시 즉시 회사에 알립니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 다음 사유가 있을 경우 가입을 거부·유보할 수 있습니다: 타인의 정보 도용, 허위 정보, 설비 여력 부족, 기타 법령 위반 등.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">6. 서비스의 제공 및 변경</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 서비스의 내용, 운영 시간, 기술 사양을 정합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 운영·보안 점검, 설비 교체, 장애 발생 등 사유로 서비스 제공이 일시 중단될 수 있으며, 가능한 한 사전 공지합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 서비스 전부 또는 일부를 변경·중단할 수 있습니다. 유료서비스 중단 시 잔여 이용료 환불 기준을 공지·적용합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">7. 이용자의 의무(금지행위)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">회원은 다음 행위를 해서는 안 됩니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 타인의 계정·개인정보 도용, 허위 정보 등록</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 저작권·상표권 등 제3자의 권리 침해, 불법 복제·공유</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 음란물·폭력물·도박·마약·자살·자해 유도 등 유해/불법 정보 유통</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 차별·혐오·괴롭힘, 명예훼손, 개인정보 노출, 타인 사칭</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 서비스 구조를 해킹·역설계·자동화 수집(크롤링)하는 행위</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 스팸·광고성 정보 무단 전송, 서비스 운영 방해</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 관련 법령, 약관, 운영정책 위반 행위</p>
            <p style="font-size: 14px; margin-bottom: 4px;">위반 시 회사는 게시물 임시조치/삭제, 이용 제한/해지, 수사기관 통보 등을 할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">8. 회원의 콘텐츠</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회원이 서비스에 게시한 콘텐츠의 저작권은 회원에게 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회원은 회사에 대해 서비스 운영·개선·노출(검색·추천 포함)을 위한 범위 내에서 비독점적·무상·재라이선스 가능한 사용권을 부여합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 관련 법령, 권리 침해 신고, 약관 위반 소지가 있는 콘텐츠를 사전 통지 없이 제한·삭제할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">9. 제3자 서비스 및 링크</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">서비스에는 외부 사이트·서비스 링크가 포함될 수 있으며, 해당 영역은 각 제공자 책임입니다. 회원은 제3자 약관과 정책을 확인해야 합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">10. 유료서비스, 결제 및 환불(해당 시)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 가격·과금 방식·환불 기준은 서비스 내에 별도 고지합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 청약철회가 가능한 재화는 관련 법령 및 고지 기준에 따라 환불합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 부정 결제·계정 공유 등 위반이 확인되면 이용을 제한하고 비용을 청구할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">11. 개인정보 보호</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">회사는 서비스 제공을 위해 필요한 범위에서 개인정보를 수집·이용하며, 세부 사항은 개인정보 처리방침에 따릅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">12. 청소년 보호</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">청소년 유해정보 차단·신고 처리·관리자 교육 등은 청소년 보호 정책을 따릅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">13. 서비스의 책임 제한</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 천재지변, 전쟁, 테러, 파업, 정부 규제, 통신망 장애 등 불가항력으로 인한 손해에 책임을 지지 않습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 회원 상호 간 또는 회원과 제3자 간의 분쟁에 개입하지 않으며, 그로 인한 손해를 배상하지 않습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 합리적 주의를 다했음에도 발생한 서비스 중단, 오류, 데이터 손실 등에 대해 중대한 과실이 없는 한 책임을 지지 않습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">14. 보증의 부인</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">서비스는 "있는 그대로" 제공됩니다. 회사는 서비스의 특정 목적 적합성, 정확성, 무오류, 비침해성에 대해 명시적·묵시적 보증을 하지 않습니다(법령이 허용하는 범위 내).</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">15. 손해배상 및 면책</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">회원이 약관 위반 또는 불법 행위로 회사에 손해를 끼친 경우 그 손해를 배상해야 합니다. 제3자의 클레임(저작권 등)으로 회사에 비용이 발생하면 회원은 회사의 손실을 면책해야 합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">16. 이용계약 해지(탈퇴) 및 제한</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회원은 언제든지 계정을 자기 책임 하에 탈퇴할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 약관·법령 위반, 장기 미접속, 운영 방해 등 사유가 있는 경우 사전 통지 후 이용을 제한하거나 계약을 해지할 수 있습니다(긴급한 경우 사후 통지).</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 해지 시 법령·정책에 따라 필요한 정보는 일정 기간 보관될 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">17. 통지</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사의 회원에 대한 통지는 서비스 내 알림, 등록된 이메일/문자 등으로 할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 다수 회원에게 통지하는 경우 서비스 내 공지로 갈음할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">18. 준거법 및 재판관할</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">본 약관은 대한민국 법령에 따릅니다. 서비스 이용과 관련하여 분쟁이 발생한 경우, 서울중앙지방법원을 제1심 전속 관할 법원으로 합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">19. 분쟁 해결(선택)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">회사와 회원은 분쟁 발생 시 소송 제기 전 고객센터를 통한 협의를 우선 시도합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">20. 약관의 해석</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">약관 조항이 무효·집행 불능인 경우에도 나머지 조항은 계속 유효합니다. 회사가 권리를 행사하지 않은 경우 이는 권리의 포기를 의미하지 않습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">21. 부칙</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 본 약관은 20XX년 XX월 XX일부터 시행합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 이전 약관은 본 약관으로 대체됩니다.</p>
            
            <button onclick="toggleTosDetail()" style="margin-top: 16px; padding: 8px 16px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              요약으로 돌아가기
            </button>
          </div>
        `
      },
      privacy: {
        title: '개인정보 처리방침',
        content: `
          <div id="privacySummary">
            <p style="margin-bottom: 4px;">수집 항목·이용 목적·보관 기간 및 파기 절차를 안내합니다.</p>
            <p class="muted" style="margin-bottom: 4px;">안전한 처리를 위해 암호화 및 접근 통제를 적용합니다.</p>
            <button onclick="togglePrivacyDetail()" style="margin-top: 12px; padding: 8px 16px; background: linear-gradient(135deg, #FF9F80, #FFC8B2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              전체 내용 보기
            </button>
          </div>
          <div id="privacyDetail" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <h4 style="font-size: 16px; font-weight: 700; color: #1F2937; margin: 0 0 8px 0;">개인정보 처리방침 전문</h4>
            <p style="font-size: 12px; color: #6B7280; margin-bottom: 8px; font-style: italic;">↓ 아래로 스크롤하여 전체 내용을 확인하세요</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">1. 총칙</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">(주식회사 ○○○)(이하 "회사")는 「개인정보 보호법」 등 관련 법령을 준수하며, 이용자의 개인정보를 안전하게 보호하기 위해 다음과 같이 처리방침을 수립·공개합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">2. 수집하는 개인정보 항목과 방법</h5>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>2-1) 수집 항목</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>회원가입 필수:</strong> 이름, 학번(아이디), 생년월일, 성별, 재학 상태, 학교 이메일(@bible.ac.kr), 비밀번호(해시 형태), 본인 식별값(내부 ID)</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>서비스 이용 과정:</strong> 접속 일시/로그(로그인·로그아웃 기록), IP, 쿠키, 기기/브라우저 정보</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>고객문의(선택):</strong> 연락처, 문의 내용, 첨부파일</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>이벤트/마케팅(선택):</strong> 수신 동의 여부, 참여 기록</p>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>2-2) 수집 방법</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회원가입·마이페이지 등 서비스 화면을 통한 직접 입력</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 서비스 이용 중 자동 생성·수집(접속 로그, 쿠키 등)</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 고객센터/문의 메일 접수</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">3. 처리 목적</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>회원 관리:</strong> 가입 의사 확인, 본인 식별/인증, 부정 이용 방지, 민원 처리</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>서비스 제공/운영:</strong> 게시판·마이페이지 등 핵심 기능 제공, 품질 개선, 통계·분석</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>보안/안전:</strong> 이상 로그인 탐지, 서비스 안정성 확보</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>고지/통지:</strong> 서비스 변경, 약관·정책 개정 안내</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>마케팅/이벤트(선택):</strong> 소식지 발송, 이벤트 운영(수신 동의한 경우에 한함)</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">4. 처리 및 보유 기간</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>회원정보:</strong> 회원 탈퇴 시까지 보관, 다만 관련 법령에 따른 의무 보존 기간이 있는 경우 해당 기간까지 보관</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• (예시) 계약·대금결제·재화공급 기록: 5년 / 소비자 불만·분쟁 처리: 3년 / 표시·광고 기록: 6개월</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>접속 로그/기기정보:</strong> 보안·운영 목적 달성 시까지 또는 관련 법령이 정한 기간</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>이벤트·마케팅 정보:</strong> 목적 달성 시까지 또는 동의 철회 시까지</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">5. 제3자 제공</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">회사는 이용자의 개인정보를 원칙적으로 제3자에게 제공하지 않습니다. 다만, 다음 경우에는 예외로 합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 이용자가 사전에 동의한 경우</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 법령에 근거한 수사·조사·재판 등 공공기관의 적법한 요구가 있는 경우</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">6. 처리의 위탁</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">원활한 서비스 제공을 위해 다음 업무를 위탁할 수 있습니다. 위탁 시 개인정보 보호 관련 계약 체결 및 관리·감독을 수행합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">7. 국외 이전(해당 시)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">서비스 인프라 또는 협력사가 국외에 있는 경우 아래 정보를 고지합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">이전받는 자(국가/연락처), 이전 일시·방법(상시 전송 등), 이전 항목, 보유·이용 기간, 보호 조치</p>
            <p style="font-size: 14px; margin-bottom: 4px;">(국외 이전이 없다면 "국외 이전을 하지 않습니다"라고 명시)</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">8. 이용자 권리와 행사 방법</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 이용자(및 법정대리인)는 언제든지 자신의 개인정보에 대해 열람·정정·삭제·처리정지를 요청할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 마이페이지에서 직접 변경 가능하거나, 고객센터/이메일로 요청</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 법령에 따른 예외 사유가 없으면 지체 없이 조치하고 결과를 통지</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 만 14세 미만 아동의 경우 법정대리인이 권리를 행사할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">9. 쿠키(Cookie)의 사용과 거부</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 회사는 맞춤형 서비스 제공을 위해 쿠키를 사용할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 브라우저 설정(쿠키 차단/삭제)으로 저장을 거부할 수 있으나, 일부 기능 이용에 제한이 있을 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">10. 개인정보의 파기 절차 및 방법</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>파기 절차:</strong> 보유 기간 경과/처리 목적 달성 후 지체 없이 파기. 내부 방침 및 법령에 따라 일정 기간 보관이 필요한 경우 별도 분리 보관 후 파기</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>파기 방법:</strong> 전자 파일은 복구·재생 불가능한 기술적 방법으로, 출력물은 분쇄·소각 등 물리적 방법으로 파기</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">11. 안전성 확보 조치</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>관리적 조치:</strong> 내부 관리계획 수립·시행, 직원 교육, 권한 관리, 접근 기록 점검</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>기술적 조치:</strong> 비밀번호 단방향 암호화(해시), 통신 구간 암호화(HTTPS/TLS), 접근통제, 악성코드 방지, 로그 모니터링</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>물리적 조치:</strong> 전산실/자료보관실 접근 통제</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">12. 개인정보 자동수집·프로파일링(해당 시)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">맞춤 추천·스팸 차단 등 자동화된 의사결정이 있는 경우 목적·로직 개요·영향 및 거부권/대안 절차를 안내합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">(없다면 "자동화된 의사결정을 수행하지 않습니다"라고 명시)</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">13. 청소년 보호</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">청소년 유해정보 차단·신고 처리·관리자 교육 등은 청소년 보호 정책을 따릅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">14. 개인정보 보호책임자 및 민원 처리</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>개인정보 보호책임자(DPO):</strong> (성명 / 직책 / 이메일 / 전화)</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>개인정보 민원·침해 신고:</strong> 고객센터, 이메일, 또는 (개인정보침해 신고센터 118 등)</p>
            <p style="font-size: 14px; margin-bottom: 4px;">회사는 문의 접수 후 법정 처리기한 내 결과를 안내합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">15. 고지 의무(변경 시 통지)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">법령 변경·서비스 개편 등으로 처리방침을 변경하는 경우, 시행 ○일 전부터 서비스 공지/이메일 등으로 안내합니다. 중요한 변경사항은 명확히 표시합니다.</p>
            
            <button onclick="togglePrivacyDetail()" style="margin-top: 16px; padding: 8px 16px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              요약으로 돌아가기
            </button>
          </div>
        `
      },
      youth: {
        title: '청소년 보호 정책',
        content: `
          <div id="youthSummary">
            <p style="margin-bottom: 4px;">유해 정보로부터 청소년을 보호하기 위한 관리·필터링 기준을 따릅니다.</p>
            <p class="muted" style="margin-bottom: 4px;">위반 신고 시 운영자가 신속히 조치합니다.</p>
            <button onclick="toggleYouthDetail()" style="margin-top: 12px; padding: 8px 16px; background: linear-gradient(135deg, #FF9F80, #FFC8B2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              전체 내용 보기
            </button>
          </div>
          <div id="youthDetail" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <h4 style="font-size: 16px; font-weight: 700; color: #1F2937; margin: 0 0 8px 0;">청소년 보호 정책 전문</h4>
            <p style="font-size: 12px; color: #6B7280; margin-bottom: 8px; font-style: italic;">↓ 아래로 스크롤하여 전체 내용을 확인하세요</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">1. 목적</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">본 정책은 본 서비스에서 제공·유통될 수 있는 유해정보로부터 청소년을 보호하고, 올바른 인터넷 사용환경을 조성하기 위해 필요한 기준과 조치를 정함을 목적으로 합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">2. 정의</h5>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>청소년:</strong> 관련 법령에서 정한 청소년에 해당하는 자</p>
            <p style="font-size: 14px; margin-bottom: 4px;"><strong>유해정보:</strong> 청소년의 건전한 성장에 해를 끼칠 우려가 있는 정보(예: 음란·폭력·도박·약물·자살·자해 유발·불법행위 조장 등)</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">3. 유해정보 차단 및 등급 관리</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 19세 이상 전용 콘텐츠에는 명확한 연령 등급 표기 및 성인 인증 절차를 적용합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 검색/목록/추천 영역에서 청소년에게 부적절한 노출을 줄이기 위해 키워드 필터링 및 카테고리 제한을 운영합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 이미지·영상 업로드 시 썸네일/미리보기 모자이크 등 사전 예방 조치를 취합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">4. 접근 제한 및 시간 제한</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 야간 시간대(예: 22:00~06:00) 특정 기능(라이브 스트리밍/채팅 등)에 대해 이용 제한 또는 안내 경고를 표시할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 위치·연령 기반으로 접근 차단 또는 기능 축소를 적용할 수 있습니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">5. 신고·심의 및 조치 절차</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 누구나 쉽게 이용할 수 있는 신고 기능을 제공하며, 신고 사유(음란, 폭력, 자해, 불법 등) 선택 메뉴를 제공합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 접수된 신고는 영업일 기준 ○일 이내 1차 검토, 필요 시 임시 차단 후 사실 확인을 진행합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 유해성이 확인되면 삭제/비공개/연령 제한/이용정지 등의 조치를 취하며, 조치 결과를 신고자에게 안내합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 외부 기관의 시정 요구가 있는 경우 관련 절차에 따라 즉시 이행합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">6. 운영자·관리자 교육</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 담당자에게 정기 교육(연 1회 이상)을 실시하여 유해정보 판별 기준, 신고 대응, 개인정보 보호, 아동·청소년 안전 이슈 등을 숙지하도록 합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 신규 입사자에게는 사전 교육을 실시합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">7. 보호자(법정대리인) 안내</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 보호자는 청소년의 계정 설정에서 알림 수신/이용 시간/커뮤니티 기능 등을 관리할 수 있습니다(제공 기능에 한함).</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 청소년 계정의 중요 변경(연령·연락처 등) 시 보호자 동의 확인 절차를 운영합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">8. 개인정보 보호(요약)</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 14세 미만 아동의 개인정보 수집 시 법정대리인 동의 절차를 거칩니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 개인정보는 최소한으로 수집하며, 목적 달성 후 지체 없이 파기합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 자세한 사항은 「개인정보 처리방침」을 따릅니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">9. 게시·유통 제휴 가이드</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 제휴 파트너/크리에이터는 본 정책과 가이드라인을 준수해야 하며, 위반 시 게시 제한·수익 정지·계약 해지 등의 조치를 받을 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 업로드 전 연령 등급 자가 분류를 권장합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">10. 재발 방지</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 동일·유사 위반이 반복되는 경우, 가중 조치(기간 연장/영구 정지)를 적용합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 반복 신고가 발생한 키워드/계정/콘텐츠 유형은 사전 검수 대상에 포함합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">11. 이용자 지원</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 청소년 유해정보 노출 또는 위험 징후 발견 시, 고객센터 또는 신고 기능을 통해 즉시 연락해 주시기 바랍니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• (필요 시) 외부 지원기관 연락처 안내(예: 상담·신고 창구)를 별도 공지에 제공합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">12. 정책의 개정</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 법령 변경, 서비스 기능 개편 등에 따라 본 정책은 개정될 수 있으며, 사전 고지 후 시행합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 중대한 변경의 경우 서비스 내 공지사항으로 최소 ○일 전 안내합니다.</p>
            
            <button onclick="toggleYouthDetail()" style="margin-top: 16px; padding: 8px 16px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              요약으로 돌아가기
            </button>
          </div>
        `
      },
      consent: {
        title: '정보 동의 설정',
        content: `
          <div id="consentSummary">
            <p style="margin-bottom: 4px;">이벤트/뉴스 알림 등 선택적 정보 수신 동의를 변경할 수 있습니다.</p>
            <p class="muted" style="margin-bottom: 4px;">마이페이지 > 알림 설정에서 항목별로 ON/OFF 하세요.</p>
            <button onclick="toggleConsentDetail()" style="margin-top: 12px; padding: 8px 16px; background: linear-gradient(135deg, #FF9F80, #FFC8B2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              전체 내용 보기
            </button>
          </div>
          <div id="consentDetail" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
            <h4 style="font-size: 16px; font-weight: 700; color: #1F2937; margin: 0 0 8px 0;">정보 동의 설정 전문</h4>
            <p style="font-size: 12px; color: #6B7280; margin-bottom: 8px; font-style: italic;">↓ 아래로 스크롤하여 전체 내용을 확인하세요</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">1. 안내</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">본 메뉴에서 마케팅 정보 수신, 맞춤 추천, 위치 기반 서비스 등 선택적 동의를 자유롭게 설정·변경할 수 있습니다. 필수 동의(서비스 제공·보안 등)와는 별개로, 선택 동의를 거부하셔도 기본 서비스 이용은 가능합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">2. 선택 동의 항목</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">아래 항목은 각각 개별 ON/OFF 가능합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>마케팅 정보 수신 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>이메일 수신 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>문자(SMS/LMS) 수신 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>앱 푸시 수신 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>전화 수신 동의(필요 시)</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>맞춤형 추천/프로파일링 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">&nbsp;&nbsp;&nbsp;서비스 이용 내역을 분석하여 개인 맞춤형 콘텐츠/혜택을 제공합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>제3자 제공(마케팅/제휴) 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">&nbsp;&nbsp;&nbsp;제휴사에 최소한의 정보가 제공될 수 있습니다. 제공 대상·목적·항목·보유기간은 상세 팝업에서 확인 가능합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>위치 정보(선택) 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">&nbsp;&nbsp;&nbsp;내 주변 서비스/혜택 안내를 위해 기기 위치를 사용합니다. 위치 사용은 설정에서 언제든 중지할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• <strong>설문·이벤트 참여 동의</strong></p>
            <p style="font-size: 14px; margin-bottom: 4px;">&nbsp;&nbsp;&nbsp;이벤트 운영, 경품 발송, 유사 행사 안내에 활용됩니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">각 항목의 구체적 목적/항목/보유기간은 토글 옆 <strong>"상세보기"</strong>로 별도 표기하세요.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">3. 설정 방법</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 각 항목 우측의 토글 스위치로 ON/OFF 하시고, 저장 버튼을 눌러 주세요.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 채널별(이메일/SMS/푸시/전화)로 세분화 설정이 가능합니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 앱 푸시는 단말 OS 알림 권한이 꺼져 있으면 발송되지 않습니다(설정 > 알림 권한 확인).</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">4. 동의 철회</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 언제든지 본 페이지에서 즉시 철회할 수 있으며, 철회 이전에 이루어진 처리에는 영향을 미치지 않습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 마케팅 수신 거부는 각 메시지 하단 '수신 거부' 링크로도 가능합니다(이메일·문자).</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">5. 보관 및 기록</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 동의/철회 이력(동의 항목, 일시, 채널, 버전)은 증빙을 위해 3년 이상 보관됩니다(법령 개정 시 조정).</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 제3자 제공 동의는 제공 이력과 함께 보관합니다.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">6. 만 14세 미만 아동</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">만 14세 미만은 법정대리인 동의가 필요할 수 있습니다. 관련 안내에 따라 절차를 진행해 주세요.</p>
            
            <h5 style="font-size: 14px; font-weight: 600; color: #374151; margin: 8px 0 4px 0;">7. 유의사항</h5>
            <p style="font-size: 14px; margin-bottom: 4px;">• 약관/개인정보 처리방침/제3자 제공 대상이 중요 변경되는 경우, 변경 시행 최소 7~30일 전 재동의를 요청할 수 있습니다.</p>
            <p style="font-size: 14px; margin-bottom: 4px;">• 시스템 반영까지 최대 ○시간 소요될 수 있습니다(내부 처리 SLA 반영).</p>
            
            <button onclick="toggleConsentDetail()" style="margin-top: 16px; padding: 8px 16px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
              요약으로 돌아가기
            </button>
          </div>
        `
      }
    };

    // 이용 안내 패널 표시 (모달 형태)
    function showInfoPanel(key) {
      const modal = document.getElementById('infoModal');
      const title = document.getElementById('infoPanelTitle');
      const content = document.getElementById('infoPanelContent');
      
      const data = infoData[key];
      
      if (data) {
        title.textContent = data.title;
        content.innerHTML = data.content;
        modal.style.display = 'flex';
        
        // 청소년 보호 정책인 경우 요약 표시
        if (key === 'youth') {
          const summary = document.getElementById('youthSummary');
          const detail = document.getElementById('youthDetail');
          if (summary && detail) {
            summary.style.display = 'block';
            detail.style.display = 'none';
          }
        }
        
        // 서비스 이용약관인 경우 요약 표시
        if (key === 'tos') {
          const summary = document.getElementById('tosSummary');
          const detail = document.getElementById('tosDetail');
          if (summary && detail) {
            summary.style.display = 'block';
            detail.style.display = 'none';
          }
        }
        
        // 개인정보 처리방침인 경우 요약 표시
        if (key === 'privacy') {
          const summary = document.getElementById('privacySummary');
          const detail = document.getElementById('privacyDetail');
          if (summary && detail) {
            summary.style.display = 'block';
            detail.style.display = 'none';
          }
        }
        
        // 정보 동의 설정인 경우 요약 표시
        if (key === 'consent') {
          const summary = document.getElementById('consentSummary');
          const detail = document.getElementById('consentDetail');
          if (summary && detail) {
            summary.style.display = 'block';
            detail.style.display = 'none';
          }
        }
      }
    }

    // 청소년 보호 정책 전체/요약 토글
    function toggleYouthDetail() {
      const summary = document.getElementById('youthSummary');
      const detail = document.getElementById('youthDetail');
      
      if (summary && detail) {
        if (detail.style.display === 'none') {
          summary.style.display = 'none';
          detail.style.display = 'block';
        } else {
          summary.style.display = 'block';
          detail.style.display = 'none';
        }
      }
    }

    // 서비스 이용약관 전체/요약 토글
    function toggleTosDetail() {
      const summary = document.getElementById('tosSummary');
      const detail = document.getElementById('tosDetail');
      
      if (summary && detail) {
        if (detail.style.display === 'none') {
          summary.style.display = 'none';
          detail.style.display = 'block';
        } else {
          summary.style.display = 'block';
          detail.style.display = 'none';
        }
      }
    }

    // 개인정보 처리방침 전체/요약 토글
    function togglePrivacyDetail() {
      const summary = document.getElementById('privacySummary');
      const detail = document.getElementById('privacyDetail');
      
      if (summary && detail) {
        if (detail.style.display === 'none') {
          summary.style.display = 'none';
          detail.style.display = 'block';
        } else {
          summary.style.display = 'block';
          detail.style.display = 'none';
        }
      }
    }

    // 정보 동의 설정 전체/요약 토글
    function toggleConsentDetail() {
      const summary = document.getElementById('consentSummary');
      const detail = document.getElementById('consentDetail');
      
      if (summary && detail) {
        if (detail.style.display === 'none') {
          summary.style.display = 'none';
          detail.style.display = 'block';
        } else {
          summary.style.display = 'block';
          detail.style.display = 'none';
        }
      }
    }

    // 이용 안내 패널 닫기
    function closeInfoPanel() {
      const modal = document.getElementById('infoModal');
      modal.style.display = 'none';
    }

    // ESC 키로 패널 닫기
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const modal = document.getElementById('infoModal');
        if (modal && modal.style.display === 'flex') {
          closeInfoPanel();
        }
      }
    });

    // 모달 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      const infoModal = document.getElementById('infoModal');
      if (e.target === infoModal) {
        closeInfoPanel();
      }
    });
  </script>
  <script src="{{ url_for("static", filename="js/navigation.js") }}"></script>
</body>
</html>
